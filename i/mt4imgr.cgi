#!/usr/bin/perl
##################################################
# 
# MT4i Manager - MT4i設定プログラム
my $version = "2.0";
# 
##################################################

#---------- 設定開始 ----------
my $password = '1341i';
#---------- 設定終了 ----------

use strict;
use CGI;

# Config.plをrequire及び存在確認
eval {require 'mt4ilib/Config.pl'; 1} || die &errorout('"./mt4ilib/Config.pl"が見付かりません。');

# 変数定義
my %cfg;
my $mt4inm = 'mt4i.cgi';

####################
# 引数の取得
my $q = new CGI();
my $mode = $q->param("mode");			# 処理モード

####################
# 引数$modeの判断
if (!$mode)				{ &login }
if ($mode eq 'edit')	{ &edit }
if ($mode eq 'vup')		{ &edit }
if ($mode eq 'save')	{ &save }

sub login {
	print "Content-type: text/html; charset=EUC-JP\n\n";
	print '<?xml version="1.0" encoding="EUC-JP"?>';
	print '<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">';
	print '<html xmlns="http://www.w3.org/1999/xhtml" lang="ja" xml:lang="ja">';
	print '<head>';
	print '<meta http-equiv="Content-Type" content="text/html; charset=EUC-JP" />';
	print '<title>MT4i Manager</title>';
	print '<style type="text/css">';
	print 'body { background-color:#ffffcc; }';
	print 'h2 { background-color:#ccffcc;border:solid 2px;text-align:center; }';
	print 'div.input { margin-left:20px;margin-right:20px;margin-bottom:20px; }';
	print 'input { height:22px;margin-bottom:10px; }';
	print '</style>';
	print '</head>';
	print '<body>';
	print '<h2>MT4i Manager '.$version.'</h2>';
	print "<form action=\"./mt4imgr.cgi\" method=\"post\">";
	print '<div class="description">';
	print 'パスワード';
	print '</div>';
	print '<div class="input">';
	print '<input type="password" name="password" />';
	print '<input type="submit" name="submit" value="ログイン" />';
	print '</div>';
	print '<input type="hidden" name="mode" value="edit" />';
	print '</form>';
	print '</body>';
	print '</html>';
}

sub edit {
	print "Content-type: text/html; charset=EUC-JP\n\n";

	print '<?xml version="1.0" encoding="EUC-JP"?>';
	print '<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">';
	print '<html xmlns="http://www.w3.org/1999/xhtml" lang="ja" xml:lang="ja">';
	print '<head>';
	print '<meta http-equiv="Content-Type" content="text/html; charset=EUC-JP" />';
	print '<title>MT4i Manager</title>';

	# パスワード認証
	my $sendpass = $q->param("password");
	if ($sendpass ne $password) {
		print '</head>';
		print '<body>';
		print 'パスワードが違います。<br />';
		print "<a href\"http://$ENV{'HTTP_HOST'}$ENV{\'SCRIPT_NAME'}\">戻る</a>";
		print "</body>";
		print "</html>";
		exit;
	}
	
	print '<style type="text/css">';
	print 'body { background-color:#ffffcc; }';
	print 'h2 { background-color:#ccffcc;border:solid 2px;text-align:center; }';
	print 'h3 { background-color:#ccffcc; }';
	print 'h4 { text-decoration:underline; }';
	print 'div.description { margin-left:10px;margin-right:10px;margin-bottom:10px; }';
	print 'div.input { margin-left:20px;margin-right:20px;margin-bottom:10px; }';
	print 'div.backlink { margin-left:30px;margin-right:10px;margin-bottom:20px; }';
	print 'input { height:22px;margin-bottom:10px; }';
	print 'select { height:22px;margin-bottom:10px; }';
	print '</style>';
	print '</head>';
	print '<body>';
	print '<h2 id="top">MT4i Manager '.$version.'</h2>';

	if ($mode eq "vup") {
		if ($q->param("mt4inm")) {
			$mt4inm = $q->param("mt4inm");
		}
		if (!-e $mt4inm) {
			print "\"$mt4inm\"が見付かりません。<br>";
			print "MT4i本体のファイル名を入力してください。<br>";
			print "<form action=\"./mt4imgr.cgi\" method=\"post\">";
			print "<input type=\"text\" name=\"mt4inm\" style=\"width:200px\"><br />";
			print "<input type=\"submit\" name=\"submit\" value=\"送信\">";
			print "<input type=\"hidden\" name=\"mode\" value=\"vup\">";
			print "<input type=\"hidden\" name=\"password\" value=\"$password\">";
			print "</form>";
			print "</body>";
			print "</html>";
			exit;
		}
		# mt4i.cgiオープン
		open(IN,"< $mt4inm") or die print "\"$mt4inm\"が見付かりません";
		
		my $rit_id_fl = 0;
		my $rat_id_fl = 0;
		while (<IN>){
			my $tmp = $_;
			chomp($tmp);
			
			if ($tmp =~ /^my/) {
				if ($tmp =~ /\(\$MT_DIR\)[^"']*["']([^"']*)["']/) {
					$cfg{'MT_DIR'} = enc_tag($1);
				} elsif ($tmp =~ /\$blog_id[^"']*["']([^"']*)["']/) {
					$cfg{'Blog_ID'} = enc_tag($1);
				} elsif ($tmp =~ /\$adm_nm[^"']*["']([^"']*)["']/) {
					$cfg{'AdmNM'} = enc_tag($1);
				} elsif ($tmp =~ /\$adm_ml[^"']*["']([^"']*)["']/) {
					$cfg{'AdmML'} = enc_tag($1);
				} elsif ($tmp =~ /\$logo_i[^"']*["']([^"']*)["']/) {
					$cfg{'Logo_i'} = enc_tag($1);
				} elsif ($tmp =~ /\$logo_o[^"']*["']([^"']*)["']/) {
					$cfg{'Logo_o'} = enc_tag($1);
				} elsif ($tmp =~ /\$dscrptn[^"']*["']([^"']*)["']/) {
					$cfg{'Dscrptn'} = enc_tag($1);
				} elsif ($tmp =~ /\$disp_num[^"']*["']([^"']*)["']/) {
					$cfg{'DispNum'} = enc_tag($1);
				} elsif ($tmp =~ /\$dt[^"']*["']([^"']*)["']/) {
					$cfg{'DT'} = enc_tag($1);
				} elsif ($tmp =~ /\$title_color[^"']*["']([^"']*)["']/) {
					$cfg{'TitleColor'} = enc_tag($1);
				} elsif ($tmp =~ /\$bg_color[^"']*["']([^"']*)["']/) {
					$cfg{'BgColor'} = enc_tag($1);
				} elsif ($tmp =~ /\$txt_color[^"']*["']([^"']*)["']/) {
					$cfg{'TxtColor'} = enc_tag($1);
				} elsif ($tmp =~ /\$lnk_color[^"']*["']([^"']*)["']/) {
					$cfg{'LnkColor'} = enc_tag($1);
				} elsif ($tmp =~ /\$alnk_color[^"']*["']([^"']*)["']/) {
					$cfg{'AlnkColor'} = enc_tag($1);
				} elsif ($tmp =~ /\$vlnk_color[^"']*["']([^"']*)["']/) {
					$cfg{'VlnkColor'} = enc_tag($1);
				} elsif ($tmp =~ /\$comment_color[^"']*["']([^"']*)["']/) {
					$cfg{'CommentColor'} = enc_tag($1);
				} elsif ($tmp =~ /\$trackback_color[^"']*["']([^"']*)["']/) {
					$cfg{'TbColor'} = enc_tag($1);
				} elsif ($tmp =~ /\$z2h[^"']*["']([^"']*)["']/) {
					$cfg{'Z2H'} = enc_tag($1);
				} elsif ($tmp =~ /\$bq2p[^"']*["']([^"']*)["']/) {
					$cfg{'BQ2P'} = enc_tag($1);
				} elsif ($tmp =~ /\$bqcolor[^"']*["']([^"']*)["']/) {
					$cfg{'BqColor'} = enc_tag($1);
				} elsif ($tmp =~ /\$sprtstr[^"']*["']([^"']*)["']/) {
					$cfg{'SprtStr'} = enc_tag($1);
					#$cfg{'SprtStr'} =~ s/&nbsp;/ /g;
				} elsif ($tmp =~ /\$sprtlimit[^"']*["']([^"']*)["']/) {
					$cfg{'SprtLimit'} = enc_tag($1);
				} elsif ($tmp =~ /\$myname[^"']*["']([^"']*)["']/) {
					$cfg{'MyName'} = enc_tag($1);
				} elsif ($tmp =~ /\$accesskey[^"']*["']([^"']*)["']/) {
					$cfg{'AccessKey'} = enc_tag($1);
				} elsif ($tmp =~ /\$image_autoreduce[^"']*["']([^"']*)["']/) {
					$cfg{'ImageAutoReduce'} = enc_tag($1);
				} elsif ($tmp =~ /\$photo_width[^"']*["']([^"']*)["']/) {
					$cfg{'PhotoWidth'} = enc_tag($1);
				} elsif ($tmp =~ /\$png_width[^"']*["']([^"']*)["']/) {
					$cfg{'PngWidth'} = enc_tag($1);
				} elsif ($tmp =~ /\$cat_desc_replace[^"']*["']([^"']*)["']/) {
					$cfg{'CatDescReplace'} = enc_tag($1);
				} elsif ($tmp =~ /\$cat_desc_sort[^"']*["']([^"']*)["']/) {
					$cfg{'CatDescSort'} = enc_tag($1);
				} elsif ($tmp =~ /\$post_from_essential[^"']*["']([^"']*)["']/) {
					$cfg{'PostFromEssential'} = enc_tag($1);
				} elsif ($tmp =~ /\$post_mail_essential[^"']*["']([^"']*)["']/) {
					$cfg{'PostMailEssential'} = enc_tag($1);
				} elsif ($tmp =~ /\$post_text_essential[^"']*["']([^"']*)["']/) {
					$cfg{'PostTextEssential'} = enc_tag($1);
				} elsif ($tmp =~ /\$recent_comment[^"']*["']([^"']*)["']/) {
					$cfg{'RecentComment'} = enc_tag($1);
				} elsif ($tmp =~ /\$recent_trackback[^"']*["']([^"']*)["']/) {
					$cfg{'RecentTB'} = enc_tag($1);
				} elsif ($tmp =~ /\$photo_host_original[^"']*["']([^"']*)["']/) {
					$cfg{'Photo_Host_Original'} = enc_tag($1);
				} elsif ($tmp =~ /\$photo_host_replace[^"']*["']([^"']*)["']/) {
					$cfg{'Photo_Host_Replace'} = enc_tag($1);
				} elsif ($tmp =~ /\$my_arc_url[^"']*["']([^"']*)["']/) {
					$cfg{'MyArcURL'} = enc_tag($1);
				} elsif ($tmp =~ /\$comment_notes[^"']*["']([^"']*)["']/) {
					$cfg{'CommentNotes'} = enc_tag($1);
				} elsif ($tmp =~ /\$exitchtmltrans[^"']*["']([^"']*)["']/) {
					$cfg{'ExitChtmlTrans'} = enc_tag($1);
				} elsif ($tmp =~ /\$ainori[^"']*["']([^"']*)["']/) {
					$cfg{'Ainori'} = enc_tag($1);
				} elsif ($tmp =~ /\@rbld_indx_tmpl_id/) {
					$rit_id_fl = 1;
					$cfg{'RIT_ID'} = '';
				} elsif ($tmp =~ /\@rbld_arc_tmpl_id/) {
					$rat_id_fl = 1;
					$cfg{'RAT_ID'} = '';
				} elsif ($tmp =~ /\$approve_comment[^"']*["']([^"']*)["']/) {
					$cfg{'ApproveComment'} = enc_tag($1);
				} elsif ($tmp =~ /\$admin_helper[^"']*["']([^"']*)["']/) {
					my @arg = split(/,/, $1);
					$cfg{'AdminHelper'} = 'yes';
					$cfg{'AdminHelperID'} = $arg[0];
					$cfg{'AdminHelperNM'} = $arg[1];
					$cfg{'AdminHelperML'} = $arg[2];
				} elsif ($tmp =~ /\$author_name[^"']*["']([^"']*)["']/) {
					$cfg{'AuthorName'} = enc_tag($1);
				} elsif ($tmp =~ /\$admin_door[^"']*["']([^"']*)["']/) {
					$cfg{'AdminDoor'} = enc_tag($1);
				} elsif ($tmp =~ /\$admin_password[^"']*["']([^"']*)["']/) {
					$cfg{'AdminPassword'} = enc_tag($1);
				}
			} elsif ($rit_id_fl == 1) {
				if ($tmp !~ /\);/) {
					$tmp =~ s/	//g;
					$tmp =~ s/ //g;
					$tmp =~ s/'//g;
					$cfg{'RIT_ID'} = $cfg{'RIT_ID'} . $tmp;
				} else {
					$rit_id_fl = 0;
					$cfg{'RIT_ID'} =~ s/,$//g;
				}
			} elsif ($rat_id_fl == 1) {
				if ($tmp !~ /\);/) {
					$tmp =~ s/	//g;
					$tmp =~ s/ //g;
					$tmp =~ s/'//g;
					$cfg{'RAT_ID'} = $cfg{'RAT_ID'} . $tmp;
				} else {
					$rat_id_fl = 0;
					$cfg{'RAT_ID'} =~ s/,$//g;
				}
			}
		}
		print '<p>';
		print '設定を読み込みました。<br />';
		print '</p>';
	} elsif (-e 'mt4icfg.cgi') {
		# 設定読み込み
		%cfg = Config::Read("./mt4icfg.cgi");
	} else {
		print '<p>';
		print '設定ファイルが存在しません。初期値を挿入します。<br />';
		print "→<a href=\"./mt4imgr.cgi?mode=vup&amp;password=$password\">v1.82β1以前の設定を読み込む。</a>";
		print '</p>';
	}

	# デフォルト値設定
	if ( !exists $cfg{'MT_DIR'} ) { $cfg{'MT_DIR'} = './'; }
	if ( !exists $cfg{'Blog_ID'} ) { $cfg{'Blog_ID'} = ''; }
	if ( !exists $cfg{'AdmNM'} ) { $cfg{'AdmNM'} = ''; }
	if ( !exists $cfg{'AdmML'} ) { $cfg{'AdmML'} = ''; }
	if ( !exists $cfg{'Logo_i'} ) { $cfg{'Logo_i'} = ''; }
	if ( !exists $cfg{'Logo_o'} ) { $cfg{'Logo_o'} = ''; }
	if ( !exists $cfg{'Dscrptn'} ) { $cfg{'Dscrptn'} = 'yes'; }
	if ( !exists $cfg{'DispNum'} ) { $cfg{'DispNum'} = 10; }
	if ( !exists $cfg{'DT'} ) { $cfg{'DT'} = 'dt'; }
	if ( !exists $cfg{'TitleColor'} ) { $cfg{'TitleColor'} = '#FF0000'; }
	if ( !exists $cfg{'BgColor'} ) { $cfg{'BgColor'} = '#FFFFFF'; }
	if ( !exists $cfg{'TxtColor'} ) { $cfg{'TxtColor'} = '#000000'; }
	if ( !exists $cfg{'LnkColor'} ) { $cfg{'LnkColor'} = '#0000FF'; }
	if ( !exists $cfg{'AlnkColor'} ) { $cfg{'AlnkColor'} = '#FF0000'; }
	if ( !exists $cfg{'VlnkColor'} ) { $cfg{'VlnkColor'} = '#800080'; }
	if ( !exists $cfg{'CommentColor'} ) { $cfg{'CommentColor'} = '#FF0000'; }
	if ( !exists $cfg{'TbColor'} ) { $cfg{'TbColor'} = '#00CC00'; }
	if ( !exists $cfg{'Z2H'} ) { $cfg{'Z2H'} = 'yes'; }
	if ( !exists $cfg{'BQ2P'} ) { $cfg{'BQ2P'} = 'no'; }
	if ( !exists $cfg{'BqColor'} ) { $cfg{'BqColor'} = '#008000'; }
	if ( !exists $cfg{'SprtStr'} ) { $cfg{'SprtStr'} = '<br />,<br>,</p>'; }
	if ( !exists $cfg{'SprtLimit'} ) { $cfg{'SprtLimit'} = 4096; }
	if ( !exists $cfg{'MyName'} ) { $cfg{'MyName'} = 'mt4i.cgi'; }
	if ( !exists $cfg{'AccessKey'} ) { $cfg{'AccessKey'} = 'yes'; }
	if ( !exists $cfg{'ImageAutoReduce'} ) { $cfg{'ImageAutoReduce'} = 'yes'; }
	if ( !exists $cfg{'PhotoWidth'} ) { $cfg{'PhotoWidth'} = 144; }
	if ( !exists $cfg{'PngWidth'} ) { $cfg{'PngWidth'} = 48; }
	if ( !exists $cfg{'CatDescReplace'} ) { $cfg{'CatDescReplace'} = 'no'; }
	if ( !exists $cfg{'CatDescSort'} ) { $cfg{'CatDescSort'} = 'none'; }
	if ( !exists $cfg{'PostFromEssential'} ) { $cfg{'PostFromEssential'} = 'yes'; }
	if ( !exists $cfg{'PostMailEssential'} ) { $cfg{'PostMailEssential'} = 'yes'; }
	if ( !exists $cfg{'PostTextEssential'} ) { $cfg{'PostTextEssential'} = 'yes'; }
	if ( !exists $cfg{'RecentComment'} ) { $cfg{'RecentComment'} = 15; }
	if ( !exists $cfg{'RecentTB'} ) { $cfg{'RecentTB'} = 10; }
	if ( !exists $cfg{'Photo_Host_Original'} ) { $cfg{'Photo_Host_Original'} = ''; }
	if ( !exists $cfg{'Photo_Host_Replace'} ) { $cfg{'Photo_Host_Replace'} = 'localhost'; }
	if ( !exists $cfg{'MyArcURL'} ) { $cfg{'MyArcURL'} = ''; }
	if ( !exists $cfg{'CommentNotes'} ) { $cfg{'CommentNotes'} = ''; }
	if ( !exists $cfg{'ExitChtmlTrans'} ) { $cfg{'ExitChtmlTrans'} = '携帯対応'; }
	if ( !exists $cfg{'Ainori'} ) { $cfg{'Ainori'} = 'no'; }
	if ( !exists $cfg{'RIT_ID'} ) { $cfg{'RIT_ID'} = 'ALL'; }
	if ( !exists $cfg{'RAT_ID'} ) { $cfg{'RAT_ID'} = 'ALL'; }
	if ( !exists $cfg{'ApproveComment'} ) { $cfg{'ApproveComment'} = 'yes'; }
	if ( !exists $cfg{'AdminHelper'} ) { $cfg{'AdminHelper'} = 'no'; }
	if ( !exists $cfg{'AdminHelperID'} ) { $cfg{'AdminHelperID'} = ''; }
	if ( !exists $cfg{'AdminHelperNM'} ) { $cfg{'AdminHelperNM'} = ''; }
	if ( !exists $cfg{'AdminHelperML'} ) { $cfg{'AdminHelperML'} = ''; }
	if ( !exists $cfg{'AuthorName'} ) { $cfg{'AuthorName'} = ''; }
	if ( !exists $cfg{'AdminDoor'} ) { $cfg{'AdminDoor'} = 'no'; }
	if ( !exists $cfg{'AdminPassword'} ) { $cfg{'AdminPassword'} = 'password'; }
	if ( !exists $cfg{'IndividualCatLabelDisp'} ) { $cfg{'IndividualCatLabelDisp'} = 'no'; }
	if ( !exists $cfg{'IndividualAuthorDisp'} ) { $cfg{'IndividualAuthorDisp'} = 'no'; }

	#----------------------------------------------------------------------------------------------------
	print '<table><tr><td>';
	print '<ul>';
	print '	<li><span style="font-weight:bold;color:#FF0000;">必須設定項目</span>';
	print '	<ul>';
	print '		<li><a href="#MT_DIR">MT_DIR - MTホームディレクトリ</a></li>';
	print '		<li><a href="#Blog_ID">Blog_ID - Movable Type 上で使用しているBlog固有のID</a></li>';
	print '	</ul>';
	print '	</li>';
	print '</ul>';
	print '<ul>';
	print '	<li>管理者モード設定項目';
	print '	<ul>';
	print '		<li><a href="#AdminHelper">AdminHelper - コメント投稿時の管理者情報入力補助</a></li>';
	print '		<li><a href="#AuthorName">AuthorName - Entry投稿時のAuthorの名前</a></li>';
	print '		<li><a href="#AdminDoor">AdminDoor - 管理者用バックドアの表示</a></li>';
	print '		<li><a href="#AdminPassword">AdminPassword - 管理者URL取得パスワード</a></li>';
	print '	</ul>';
	print '	</li>';
	print '</ul>';
	print '<ul>';
	print '	<li>表示関連設定項目';
	print '	<ul>';
	print '		<li><a href="#AdmNML">管理者名の表示とメールアドレス</a></li>';
	print '		<li><a href="#Logo">タイトルロゴ画像を設定する</a></li>';
	print '		<li><a href="#Dscrptn">Dscrptn - トップへの概要の表示</a></li>';
	print '		<li><a href="#DispNum">DispNum - トップ（記事一覧）に表示させる記事数</a></li>';
	print '		<li><a href="#DT">DT - トップ（記事一覧）での投稿日時の表示</a></li>';
	print '		<li><a href="#Colors">色の設定</a></li>';
	print '		<li><a href="#CommentNotes">CommentNotes - コメント投稿フォーム注意書き</a></li>';
	print '		<li><a href="#IndividualCatLabelDisp">IndividualCatLabelDisp - 個別記事画面でのカテゴリ名表示</a></li>';
	print '		<li><a href="#IndividualAuthorDisp">IndividualAuthorDisp - 個別記事画面でのAuthor名表示</a></li>';
	print '	</ul>';
	print '	</li>';
	print '</ul>';
	print '</td><td>';
	print '<ul>';
	print '	<li>その他任意設定項目';
	print '	<ul>';
	print '		<li><a href="#Z2H">Z2H - 全角→半角変換</a></li>';
	print '		<li><a href="#BQ2P">BQ2P - &lt;blockquote&gt;→&lt;p&gt;変換</a></li>';
	print '		<li><a href="#SprtStr">SprtStr - 記事分割時の区切り文字列</a></li>';
	print '		<li><a href="#SprtLimit">SprtLimit - 記事本文を分割をする制限バイト数</a></li>';
	print '		<li><a href="#MyName">MyName - MT4i本体のファイル名</a></li>';
	print '		<li><a href="#AccessKey">AccessKey - 携帯電話の絵文字及びアクセスキー</a></li>';
	print '		<li><a href="#ImageAutoReduce">ImageAutoReduce - 画像の自動縮小</a></li>';
	print '		<li><a href="#PhotoWidth">PhotoWidth - デフォルト画像の横幅</a></li>';
	print '		<li><a href="#PngWidth">PngWidth - vodafoneの特定機種(6機種)のPNG画像の横幅</a></li>';
	print '		<li><a href="#CatDescReplace">CatDescReplace - カテゴリ名のDescription置換</a></li>';
	print '		<li><a href="#CatDescSort">CatDescSort - カテゴリ名のソート</a></li>';
	print '		<li><a href="#PostEssential">コメント投稿時入力必須項目の指定</a></li>';
	print '		<li><a href="#RecentComment">RecentComment - 最近のコメント一覧表示コメント数</a></li>';
	print '		<li><a href="#RecentTB">RecentTB - 最近のトラックバック表示数</a></li>';
	print '		<li><a href="#Photo_Host">Photo_Host_Original/Replace - 自宅サーバの外/内部ホスト名</a></li>';
	print '		<li><a href="#MyArcURL">MyArcURL - 自サイト内リンクURLの正規表現</a></li>';
	print '		<li><a href="#ExitChtmlTrans">ExitChtmlTrans - chtmltrans変換の無効化</a></li>';
	print '		<li><a href="#Ainori">Ainori - あいのり機能</a></li>';
	print '		<li><a href="#RIAT_ID">コメント投稿時のRebuild対象テンプレートを指定する</a></li>';
	print '		<li><a href="#ApproveComment">ApproveComment - コメント掲載の承諾（MT3.0以上で有効）</a></li>';
	print '	</ul>';
	print '	</li>';
	print '</ul>';
	print '</td></tr></table>';
	#----------------------------------------------------------------------------------------------------

	print "<form action=\"./mt4imgr.cgi\" method=\"post\">";
	print '<input type="submit" name="submit" value="保存" /><br />';

	#----------------------------------------------------------------------------------------------------
	print '<h3>必須設定項目</h3>';
	print '<h4 id="MT_DIR">MT_DIR - MTホームディレクトリ</h4>';
	print '<div class="description">';
	print 'Movable Type をインストールしたディレクトリ（mt.cgiのある場所）を、絶対パスあるいは相対パスで指定。<br />「"http://〜" で始まるURLではない」ので注意。<br />またMT3.0以上では、MTホームディレクトリ以外のディレクトリにMT4iをインストールし、相対パスにてMTホームディレクトリを指定した場合、一部機能が正常に動作しないことを確認しています（Pluginにて追加したテキストフォーマットがドロップダウンリストに現われないなど）。<br />MT3.0以上を使用している場合は、絶対パスで指定してください。<br />';
	print '</div>';
	print '<div class="input">';
	print '<input type="text" name="MT_DIR" value="' . $cfg{MT_DIR} . '" /><br />';
	print '</div><div class="backlink"><a href="#top">ページのTOPへ戻る</a></div>';

	print '<h4 id="Blog_ID">Blog_ID - Movable Type 上で使用しているBlog固有のID</h4>';
	print '<div class="description">';
	print 'Movable Type 設置後、デフォルトで作成されるBlogのIDが "1"。<br />その後、Blogを追加する毎に連番で付与される。<br />ここで指定しなくても、アクセスする際のURLに "?id=" として渡してやっても良い。<br />MT4iへのURLが "http://your-domain/mt4i.cgi"、BlogのIDが "1" ならば、<br />"http://your-domain/mt4i.cgi?id=1" となる。<br />良く分からない場合はここで指定せずに設置、アクセスすると解説を表示するのでそちらを参照のこと。<br />';
	print '</div>';
	print '<div class="input">';
	print '<input type="text" name="Blog_ID" value="' . $cfg{Blog_ID} . '" /><br />';
	print '</div><div class="backlink"><a href="#top">ページのTOPへ戻る</a></div>';

	#----------------------------------------------------------------------------------------------------
	print '<h3>任意設定項目</h3>';
	print '<h4 id="AdmNML">管理者名の表示とメールアドレス</h4>';
	print '<div class="description">';
	print '各画面下に管理者名を表示する場合には管理者名を入力する。<br />';
	print '何も入力されていなければ非表示。';
	print '</div>';
	print '<div class="input">';
	print '管理者名： <input type="text" name="AdmNM" value="' . $cfg{AdmNM} . '" /><br />';
	print '</div>';
	print '<div class="description">';
	print '上記管理者名に、"mailto:〜" のハイパーリンクを貼る場合には管理者メールアドレスを入力する。<br />必然的に上記管理者名の設定が必須。<br />メールアドレスは表示時、"@" と "." のみ数値文字参照に変換（SPAMメール対策）。<br />';
	print '</div>';
	print '<div class="input">';
	print '管理者メールアドレス： <input type="text" name="AdmML" value="' . $cfg{AdmML} . '" style="width:200px;" /><br />';
	print '</div><div class="backlink"><a href="#top">ページのTOPへ戻る</a></div>';

	print '<h4 id="Logo">Logo - タイトルロゴ画像の指定</h4>';
	print '<div class="description">';
	print 'トップに表示するタイトルを画像表示したい場合、表示したい画像のURLを入力。相対パスでも可。未入力ならテキストで表示。i-mode用はGIF、i-mode以外用はPNG画像を指定すること。<br />';
	print '</div>';
	print '<div class="input">';
	print 'i-mode用： ';
	print '<input type="text" name="Logo_i" value="' . $cfg{Logo_i} . '" style="width:400px;" /><br />';
	print 'i-mode以外用： ';
	print '<input type="text" name="Logo_o" value="' . $cfg{Logo_o} . '" style="width:400px;" /><br />';
	print '</div><div class="backlink"><a href="#top">ページのTOPへ戻る</a></div>';

	print '<h4 id="Dscrptn">Dscrptn - トップへの概要の表示</h4>';
	print '<div class="description">';
	print '「概要」とは、Movable Type にて各Blogに登録されている概要（Description）のこと。<br />表示する場合には "yes"、表示しない場合には "no" を選択。<br />';
	print '</div>';
	print '<div class="input">';
	print '<select name="Dscrptn">';
	if ($cfg{Dscrptn} eq 'yes') {
		print '<option value="yes" selected>yes</option>';
		print '<option value="no">no</option>';
	} else {
		print '<option value="yes">yes</option>';
		print '<option value="no" selected>no</option>';
	}
	print '</select>';
	print '</div><div class="backlink"><a href="#top">ページのTOPへ戻る</a></div>';

	print '<h4 id="DispNum">DispNum - トップ（記事一覧）に表示させる記事数</h4>';
	print '<div class="input">';
	print '<input type="text" name="DispNum" value="' . $cfg{DispNum} . '" /><br />';
	print '</div><div class="backlink"><a href="#top">ページのTOPへ戻る</a></div>';

	print '<h4 id="DT">DT - トップ（記事一覧）での投稿日時の表示</h4>';
	print '<div class="input">';
	print '<select name="DT">';
	if ($cfg{DT} eq 'dt') {
		print '<option value="dt" selected>日付 + 時間</option>';
		print '<option value="d">日付のみ</option>';
		print '<option value="no">表示しない</option>';
	} elsif ($cfg{DT} eq 'd') {
		print '<option value="dt">日付 + 時間</option>';
		print '<option value="d" selected>日付のみ</option>';
		print '<option value="no">表示しない</option>';
	} else {
		print '<option value="dt">日付 + 時間</option>';
		print '<option value="d">日付のみ</option>';
		print '<option value="no" selected>表示しない</option>';
	}
	print '</select>';
	print '</div><div class="backlink"><a href="#top">ページのTOPへ戻る</a></div>';

	print '<h4 id="Colors">色の設定</h4>';
	print '<div class="input">';
	print '<table border="0">';
	print '<tr><td>';
	print 'トップタイトルの色：';
	print '</td><td>';
	print '<input type="text" name="TitleColor" value="' . $cfg{TitleColor} . '" /><br />';
	print '</td></tr><tr><td>';
	print '背景色(bgcolor)：';
	print '</td><td>';
	print '<input type="text" name="BgColor" value="' . $cfg{BgColor} . '" /><br />';
	print '</td></tr><tr><td>';
	print 'テキストの色(text)：';
	print '</td><td>';
	print '<input type="text" name="TxtColor" value="' . $cfg{TxtColor} . '" /><br />';
	print '</td></tr><tr><td>';
	print 'リンク色(link)：';
	print '</td><td>';
	print '<input type="text" name="LnkColor" value="' . $cfg{LnkColor} . '" /><br />';
	print '</td></tr><tr><td>';
	print 'アクティブなリンク色(alink)：';
	print '</td><td>';
	print '<input type="text" name="AlnkColor" value="' . $cfg{AlnkColor} . '" /><br />';
	print '</td></tr><tr><td>';
	print '既訪問のリンク色(vlink)：';
	print '</td><td>';
	print '<input type="text" name="VlnkColor" value="' . $cfg{VlnkColor} . '" /><br />';
	print '</td></tr><tr><td>';
	print '一覧表示時コメント数の色：';
	print '</td><td>';
	print '<input type="text" name="CommentColor" value="' . $cfg{CommentColor} . '" />';
	print ' Entryのタイトル横に表示される数字。"no"指定で非表示。';
	print '</td></tr><tr><td>';
	print '一覧表示時トラックバック数の色：';
	print '</td><td>';
	print '<input type="text" name="TbColor" value="' . $cfg{TbColor} . '" />';
	print ' Entryのタイトル横に表示される数字。"no"指定で非表示。';
	print '</td></tr><tr><td>';
	print 'Entry本文&lt;blockquote&gt;部の色： ';
	print '</td><td>';
	print '<input type="text" name="BqColor" value="' . $cfg{BqColor} . '" />';
	print ' Movable Type の設定で、convert_breaks が ON になっていることが前提。';
	print '</td></tr>';
	print '</table>';
	print '</div><div class="backlink"><a href="#top">ページのTOPへ戻る</a></div>';

	print '<h4 id="Z2H">Z2H - 全角→半角変換</h4>';
	print '<div class="input">';
	print '<select name="Z2H">';
	if ($cfg{Z2H} eq 'yes') {
		print '<option value="yes" selected>する</option>';
		print '<option value="no">しない</option>';
	} else {
		print '<option value="yes">する</option>';
		print '<option value="no" selected>しない</option>';
	}
	print '</select>';
	print '</div><div class="backlink"><a href="#top">ページのTOPへ戻る</a></div>';

	print '<h4 id="BQ2P">BQ2P - &lt;blockquote&gt;→&lt;p&gt;変換</h4>';
	print '<div class="description">';
	print 'Movable Type の設定で、convert_breaks が ON になっていることが前提。';
	print '</div>';
	print '<div class="input">';
	print '<select name="BQ2P">';
	if ($cfg{BQ2P} eq 'yes') {
		print '<option value="yes" selected>する</option>';
		print '<option value="no">しない</option>';
	} else {
		print '<option value="yes">する</option>';
		print '<option value="no" selected>しない</option>';
	}
	print '</select>';
	print '</div><div class="backlink"><a href="#top">ページのTOPへ戻る</a></div>';

	print '<h4 id="SprtStr">SprtStr - 記事分割時の区切り文字列</h4>';
	print '<div class="description">';
	print 'カンマで区切って複数パターン指定することができます。<br />';
	print '1番目に指定した文字列がマッチしなかったら2番目、と順番にマッチングします。<br />';
	print '例：&lt;br /&gt;,&lt;br&gt;,&lt;/p&gt;';
	print '</div>';
	print '<div class="input">';
	print '<input type="text" name="SprtStr" value="' . $cfg{SprtStr} . '" /><br />';
	print '</div><div class="backlink"><a href="#top">ページのTOPへ戻る</a></div>';

	print '<h4 id="SprtLimit">SprtLimit - 記事本文を分割をする制限バイト数（ヘッダやフッタを考慮すること）</h4>';
	print '<div class="input">';
	print '<input type="text" name="SprtLimit" value="' . $cfg{SprtLimit} . '" /><br />';
	print '</div><div class="backlink"><a href="#top">ページのTOPへ戻る</a></div>';

	print '<h4 id="">MyName - MT4i本体のファイル名（index.cgiなどに変更したい人用）</h4>';
	print '<div class="input">';
	print '<input type="text" name="MyName" value="' . $cfg{MyName} . '" /><br />';
	print '</div><div class="backlink"><a href="#top">ページのTOPへ戻る</a></div>';

	print '<h4 id="AccessKey">AccessKey - 携帯電話の絵文字及びアクセスキー</h4>';
	print '<div class="description">';
	print 'これを有効にすると、携帯電話からアクセスされた際、自動的に記事一覧で表示される記事数が6件以下に調整されます。<br />';
	print '</div>';
	print '<div class="input">';
	print '<select name="AccessKey">';
	if ($cfg{AccessKey} eq 'yes') {
		print '<option value="yes" selected>有効</option>';
		print '<option value="no">無効</option>';
	} else {
		print '<option value="yes">有効</option>';
		print '<option value="no" selected>無効</option>';
	}
	print '</select>';
	print '</div><div class="backlink"><a href="#top">ページのTOPへ戻る</a></div>';

	print '<h4 id="ImageAutoReduce">ImageAutoReduce - 画像の自動縮小</h4>';
	print '<div class="input">';
	print '<select name="ImageAutoReduce">';
	if ($cfg{ImageAutoReduce} eq 'yes') {
		print '<option value="yes" selected>する</option>';
		print '<option value="no">しない</option>';
	} else {
		print '<option value="yes">する</option>';
		print '<option value="no" selected>しない</option>';
	}
	print '</select>';
	print '</div><div class="backlink"><a href="#top">ページのTOPへ戻る</a></div>';

	print '<h4 id="PhotoWidth">PhotoWidth - デフォルト画像の横幅</h4>';
	print '<div class="input">';
	print '<input type="text" name="PhotoWidth" value="' . $cfg{PhotoWidth} . '" /><br />';
	print '</div><div class="backlink"><a href="#top">ページのTOPへ戻る</a></div>';

	print '<h4 id="PngWidth">PngWidth - vodafoneの特定機種(6機種)のPNG画像の横幅</h4>';
	print '<div class="input">';
	print '<input type="text" name="PngWidth" value="' . $cfg{PngWidth} . '" /><br />';
	print '</div><div class="backlink"><a href="#top">ページのTOPへ戻る</a></div>';

	print '<h4 id="CatDescReplace">CatDescReplace - カテゴリ名のDescription置換</h4>';
	print '<div class="description">';
	print 'カテゴリ名の日本語化をMTCategoryDescriptionで行っているか。';
	print '</div>';
	print '<div class="input">';
	print '<select name="CatDescReplace">';
	if ($cfg{CatDescReplace} eq 'yes') {
		print '<option value="yes" selected>行っている</option>';
		print '<option value="no">行っていない</option>';
	} else {
		print '<option value="yes">行っている</option>';
		print '<option value="no" selected>行っていない</option>';
	}
	print '</select>';
	print '</div><div class="backlink"><a href="#top">ページのTOPへ戻る</a></div>';

	print '<h4 id="CatDescSort">CatDescSort - カテゴリ名のソート</h4>';
	print '<div class="input">';
	print '<select name="CatDescSort">';
	if ($cfg{CatDescSort} eq 'none') {
		print '<option value="none" selected>しない</option>';
		print '<option value="asc">昇順</option>';
		print '<option value="desc">降順</option>';
	} elsif ($cfg{CatDescSort} eq 'asc') {
		print '<option value="none">しない</option>';
		print '<option value="asc" selected>昇順</option>';
		print '<option value="desc">降順</option>';
	} else {
		print '<option value="none">しない</option>';
		print '<option value="asc">昇順</option>';
		print '<option value="desc" selected>降順</option>';
	}
	print '</select>';
	print '</div><div class="backlink"><a href="#top">ページのTOPへ戻る</a></div>';

	print '<h4 id="PostEssential">コメント投稿時入力必須項目の指定</h4>';
	print '<div class="input">';
	print '<table border="0">';
	print '<tr><td>';
	print '投稿者名：';
	print '</td><td>';
	print '<select name="PostFromEssential">';
	if ($cfg{PostFromEssential} eq 'yes') {
		print '<option value="yes" selected>必須</option>';
		print '<option value="no">省略可</option>';
	} else {
		print '<option value="yes">必須</option>';
		print '<option value="no" selected>省略可</option>';
	}
	print '</select>';
	print '</td></tr><tr><td>';
	print 'メールアドレス：';
	print '</td><td>';
	print '<select name="PostMailEssential">';
	if ($cfg{PostMailEssential} eq 'yes') {
		print '<option value="yes" selected>必須</option>';
		print '<option value="no">省略可</option>';
	} else {
		print '<option value="yes">必須</option>';
		print '<option value="no" selected>省略可</option>';
	}
	print '</select>';
	print '</td></tr><tr><td>';
	print 'コメント本文：';
	print '</td><td>';
	print '<select name="PostTextEssential">';
	if ($cfg{PostTextEssential} eq 'yes') {
		print '<option value="yes" selected>必須</option>';
		print '<option value="no">省略可</option>';
	} else {
		print '<option value="yes">必須</option>';
		print '<option value="no" selected>省略可</option>';
	}
	print '</select>';
	print '</td></tr>';
	print '</table>';
	print '</div><div class="backlink"><a href="#top">ページのTOPへ戻る</a></div>';

	print '<h4 id="RecentComment">RecentComment - 最近のコメント一覧表示コメント数</h4>';
	print '<div class="input">';
	print '<input type="text" name="RecentComment" value="' . $cfg{RecentComment} . '" /><br />';
	print '</div><div class="backlink"><a href="#top">ページのTOPへ戻る</a></div>';

	print '<h4 id="RecentTB">RecentTB - 最近のトラックバック表示数</h4>';
	print '<div class="input">';
	print '<input type="text" name="RecentTB" value="' . $cfg{RecentTB} . '" /><br />';
	print '</div><div class="backlink"><a href="#top">ページのTOPへ戻る</a></div>';

	print '<h4 id="Photo_Host">Photo_Host_Original/Replace - 自宅サーバの外部／内部ホスト名</h4>';
	print '<div class="description">';
	print '自宅サーバ運用等で画像縮小が動かない場合、\'Photo_Host_Original\'に外から見えるホスト名を入力。<br />';
	print '(記述例)\'www.hazama.nu\'の場合、<br />';
	print 'http://www.hazama.nu/archive/test.jpg が http://localhost/archive/test.jpg に置換されることで、自ホストの画像データを読み込むことができるようになる場合あり。<br />';
	print '\'Photo_Host_Original\'未入力で機能オフ。<br />';
	print '</div>';
	print '<div class="input">';
	print '外部ホスト名: ';
	print '<input type="text" name="Photo_Host_Original" value="' . $cfg{Photo_Host_Original} . '" /><br />';
	print '内部ホスト名: ';
	print '<input type="text" name="Photo_Host_Replace" value="' . $cfg{Photo_Host_Replace} . '" /><br />';
	print '</div><div class="backlink"><a href="#top">ページのTOPへ戻る</a></div>';

	print '<h4 id="MyArcURL">MyArcURL - 自サイト内リンクURLの正規表現</h4>';
	print '<div class="description">';
	print '文字列に適合するURLへのリンクを、MT4iの個別記事URLへ変換する。<br />';
	print 'ただし、parmalinkにEntryIDが含まれていることが前提条件。<br />';
	print '未入力で機能オフ。<br />';
	print 'また、あいのり機能オンでも機能オフ。<br />';
	print '例：http://yourdomain/archives/(\d\d\d\d\d\d).html<br />';
	print '</div>';
	print '<div class="input">';
	print '<input type="text" name="MyArcURL" value="' . $cfg{MyArcURL} . '" style="width:400px;" /><br />';
	print '</div><div class="backlink"><a href="#top">ページのTOPへ戻る</a></div>';

	print '<h4 id="CommentNotes">CommentNotes - コメント投稿フォーム注意書き</h4>';
	print '<div class="description">';
	print '指定された文字列をコメント投稿フォームの最上部に表示する。<br />';
	print '表示しない場合は何も入力しない。<br />';
	print '※MTMLタグ使用可。改行は保存時に削除されます。<br />';
	print '</div>';
	print '<div class="input">';
	print '<textarea name="CommentNotes" rows="5" style="width:400px;">';
	print $cfg{CommentNotes};
	print '</textarea>';
	print '</div><div class="backlink"><a href="#top">ページのTOPへ戻る</a></div>';

	print '<h4 id="ExitChtmlTrans">ExitChtmlTrans - chtmltrans変換の無効化</h4>';
	print '<div class="description">';
	print 'AタグのTITLE属性が指定した文字列を含む場合、chtmltrans変換しない。<br />';
	print '</div>';
	print '<div class="input">';
	print '<input type="text" name="ExitChtmlTrans" value="' . $cfg{ExitChtmlTrans} . '" /><br />';
	print '</div><div class="backlink"><a href="#top">ページのTOPへ戻る</a></div>';

	print '<h4 id="Ainori">Ainori - あいのり機能</h4>';
	print '<div class="input">';
	print '<select name="Ainori">';
	if ($cfg{Ainori} eq 'yes') {
		print '<option value="yes" selected>ON</option>';
		print '<option value="no">OFF</option>';
	} else {
		print '<option value="yes">ON</option>';
		print '<option value="no" selected>OFF</option>';
	}
	print '</select>';
	print '</div><div class="backlink"><a href="#top">ページのTOPへ戻る</a></div>';

	print '<h4 id="RIAT_ID">コメント投稿時のRebuild対象テンプレートを指定する</h4>';
	print '<div class="description">';
	print 'コメント投稿時にRebuildの対象とするIndexテンプレートのTemplete IDを指定する。<br />';
	print 'Indexテンプレートすべてを対象とするなら"ALL"と指定する。<br />';
	print '各IDはカンマ（,）で区切る（注：スペースは入れないこと）<br />';
	print '例：10,13,20<br />';
	print '</div>';
	print '<div class="input">';
	print 'Indexテンプレート：<input type="text" name="RIT_ID" value="' . $cfg{RIT_ID} . '" style="width:300px;" /><br />';
	print '</div>';
	print '<div class="description">';
	print 'コメント投稿時にRebuildの対象とするArchiveテンプレートを指定する。<br />';
	print 'Archiveテンプレートすべてを対象とするなら"ALL"と指定する。';
	print '各IDはカンマ（,）で区切る（注：スペースは入れないこと）<br />';
	print '例：Individual,Daily,Weekly,Monthly,Category<br />';
	print '</div>';
	print '<div class="input">';
	print 'Archiveテンプレート：<input type="text" name="RAT_ID" value="' . $cfg{RAT_ID} . '" style="width:300px;" /><br />';
	print '</div><div class="backlink"><a href="#top">ページのTOPへ戻る</a></div>';

	print '<h4 id="IndividualCatLabelDisp">IndividualCatLabelDisp - 個別記事画面でのカテゴリ名表示</h4>';
	print '<div class="description">';
	print 'タイトル横へのカテゴリ名表示。';
	print '</div>';
	print '<div class="input">';
	print '<select name="IndividualCatLabelDisp">';
	if ($cfg{IndividualCatLabelDisp} eq 'yes') {
		print '<option value="yes" selected>表示する</option>';
		print '<option value="no">表示しない</option>';
	} else {
		print '<option value="yes">表示する</option>';
		print '<option value="no" selected>表示しない</option>';
	}
	print '</select>';
	print '</div><div class="backlink"><a href="#top">ページのTOPへ戻る</a></div>';

	print '<h4 id="IndividualAuthorDisp">IndividualAuthorDisp - 個別記事画面でのAuthor名表示</h4>';
	print '<div class="description">';
	print 'タイトル横へのAuthor名表示。<br />';
	print 'ニックネームが入力されていれば、ニックネームを表示する。<br />';
	print 'Authorが複数いる場合などに。<br />';
	print '</div>';
	print '<div class="input">';
	print '<select name="IndividualAuthorDisp">';
	if ($cfg{IndividualAuthorDisp} eq 'yes') {
		print '<option value="yes" selected>表示する</option>';
		print '<option value="no">表示しない</option>';
	} else {
		print '<option value="yes">表示する</option>';
		print '<option value="no" selected>表示しない</option>';
	}
	print '</select>';
	print '</div><div class="backlink"><a href="#top">ページのTOPへ戻る</a></div>';

	print '<h4 id="ApproveComment">ApproveComment - コメント掲載の承諾（MT3.0以上で有効）</h4>';
	print '<div class="input">';
	print '<select name="ApproveComment">';
	if ($cfg{ApproveComment} eq 'yes') {
		print '<option value="yes" selected>即承諾する</option>';
		print '<option value="no">一旦保留する</option>';
	} else {
		print '<option value="yes">即承諾する</option>';
		print '<option value="no" selected>一旦保留する</option>';
	}
	print '</select>';
	print '</div><div class="backlink"><a href="#top">ページのTOPへ戻る</a></div>';

	#----------------------------------------------------------------------------------------------------
	print '<h3>管理者モード設定項目</h3>';
	print '<h4 id="AdminHelper">AdminHelper - コメント投稿時の管理者情報入力を手助け</h4>';
	print '<div class="description">';
	print '名前の代わりにIDを記入するだけで、名前、メールアドレスが自動的に記入される。<br />';
	print '管理者モードでのみ有効。<br />';
	print '</div>';
	print '<div class="input">';
	print '<table border="0">';
	print '<tr><td>';
	print 'AdminHelperを使用する';
	print '</td><td>';
	print '<select name="AdminHelper">';
	if ($cfg{AdminHelper} eq 'yes') {
		print '<option value="yes" selected>はい</option>';
		print '<option value="no">いいえ</option>';
	} else {
		print '<option value="yes">はい</option>';
		print '<option value="no" selected>いいえ</option>';
	}
	print '</select>';
	print '</td></tr><tr><td>';
	print 'ID：';
	print '</td><td>';
	print '<input type="text" name="AdminHelperID" value="' . $cfg{AdminHelperID} . '" /><br />';
	print '</td></tr><tr><td>';
	print '名前：';
	print '</td><td>';
	print '<input type="text" name="AdminHelperNM" value="' . $cfg{AdminHelperNM} . '" /><br />';
	print '</td></tr><tr><td>';
	print 'メールアドレス：';
	print '</td><td>';
	print '<input type="text" name="AdminHelperML" value="' . $cfg{AdminHelperML} . '" style="width:200px;" /><br />';
	print '</td></tr>';
	print '</table>';
	print '</div><div class="backlink"><a href="#top">ページのTOPへ戻る</a></div>';

	print '<h4 id="AuthorName">AuthorName - Entry投稿時のAuthorの名前</h4>';
	print '<div class="description">';
	print 'MovableTypeに登録済みのAuthor名を指定する。<br />';
	print '</div>';
	print '<div class="input">';
	print '<input type="text" name="AuthorName" value="' . $cfg{AuthorName} . '" /><br />';
	print '</div><div class="backlink"><a href="#top">ページのTOPへ戻る</a></div>';

	print '<h4 id="AdminDoor">AdminDoor - 管理者用バックドアの表示</h4>';
	print '<div class="description">';
	print '初回起動時「管理者向けURL取得」リンクを表示する。<br />';
	print '管理者向けURLをブックマークした後は必ず "no" に設定すること。<br />';
	print '</div>';
	print '<div class="input">';
	print '<select name="AdminDoor">';
	if ($cfg{AdminDoor} eq 'yes') {
		print '<option value="yes" selected>yes</option>';
		print '<option value="no">no</option>';
	} else {
		print '<option value="yes">yes</option>';
		print '<option value="no" selected>no</option>';
	}
	print '</select>';
	print '</div><div class="backlink"><a href="#top">ページのTOPへ戻る</a></div>';

	print '<h4 id="AdminPassword">AdminPassword - 「管理者向けURL取得」の為のパスワード</h4>';
	print '<div class="description">';
	print '英数字。必ずデフォルトのパスワードから変更すること。<br />';
	print '</div>';
	print '<div class="input">';
	print '<input type="text" name="AdminPassword" value="' . $cfg{AdminPassword} . '" /><br />';
	print '</div><div class="backlink"><a href="#top">ページのTOPへ戻る</a></div>';

	#----------------------------------------------------------------------------------------------------
	print '<input type="submit" name="submit" value="保存">';
	print '<input type="hidden" name="mode" value="save">';
	print "<input type=\"hidden\" name=\"password\" value=\"$password\">";
	print '</form>';

	print '</body>';
	print '</html>';
}

sub save {
	####################
	# 引数の取得
	$cfg{'MT_DIR'} = del_rn($q->param('MT_DIR'));
	$cfg{'Blog_ID'} = del_rn($q->param('Blog_ID'));
	$cfg{'AdmNM'} = del_rn($q->param('AdmNM'));
	$cfg{'AdmML'} = del_rn($q->param('AdmML'));
	$cfg{'Logo_i'} = del_rn($q->param('Logo_i'));
	$cfg{'Logo_o'} = del_rn($q->param('Logo_o'));
	$cfg{'Dscrptn'} = del_rn($q->param('Dscrptn'));
	$cfg{'DispNum'} = del_rn($q->param('DispNum'));
	$cfg{'DT'} = del_rn($q->param('DT'));
	$cfg{'TitleColor'} = del_rn($q->param('TitleColor'));
	$cfg{'BgColor'} = del_rn($q->param('BgColor'));
	$cfg{'TxtColor'} = del_rn($q->param('TxtColor'));
	$cfg{'LnkColor'} = del_rn($q->param('LnkColor'));
	$cfg{'AlnkColor'} = del_rn($q->param('AlnkColor'));
	$cfg{'VlnkColor'} = del_rn($q->param('VlnkColor'));
	$cfg{'CommentColor'} = del_rn($q->param('CommentColor'));
	$cfg{'TbColor'} = del_rn($q->param('TbColor'));
	$cfg{'Z2H'} = del_rn($q->param('Z2H'));
	$cfg{'BQ2P'} = del_rn($q->param('BQ2P'));
	$cfg{'BqColor'} = del_rn($q->param('BqColor'));
	$cfg{'SprtStr'} = del_rn($q->param('SprtStr'));
	#$cfg{'SprtStr'} =~ s/ /&nbsp;/g;
	$cfg{'SprtLimit'} = del_rn($q->param('SprtLimit'));
	$cfg{'MyName'} = del_rn($q->param('MyName'));
	$cfg{'AccessKey'} = del_rn($q->param('AccessKey'));
	$cfg{'ImageAutoReduce'} = del_rn($q->param('ImageAutoReduce'));
	$cfg{'PhotoWidth'} = del_rn($q->param('PhotoWidth'));
	$cfg{'PngWidth'} = del_rn($q->param('PngWidth'));
	$cfg{'CatDescReplace'} = del_rn($q->param('CatDescReplace'));
	$cfg{'CatDescSort'} = del_rn($q->param('CatDescSort'));
	$cfg{'PostFromEssential'} = del_rn($q->param('PostFromEssential'));
	$cfg{'PostMailEssential'} = del_rn($q->param('PostMailEssential'));
	$cfg{'PostTextEssential'} = del_rn($q->param('PostTextEssential'));
	$cfg{'RecentComment'} = del_rn($q->param('RecentComment'));
	$cfg{'RecentTB'} = del_rn($q->param('RecentTB'));
	$cfg{'Photo_Host_Original'} = del_rn($q->param('Photo_Host_Original'));
	$cfg{'Photo_Host_Replace'} = del_rn($q->param('Photo_Host_Replace'));
	$cfg{'MyArcURL'} = del_rn($q->param('MyArcURL'));
	$cfg{'CommentNotes'} = del_rn($q->param('CommentNotes'));
	$cfg{'ExitChtmlTrans'} = del_rn($q->param('ExitChtmlTrans'));
	$cfg{'Ainori'} = del_rn($q->param('Ainori'));
	$cfg{'RIT_ID'} = del_rn($q->param('RIT_ID'));
	$cfg{'RAT_ID'} = del_rn($q->param('RAT_ID'));
	$cfg{'ApproveComment'} = del_rn($q->param('ApproveComment'));
	$cfg{'AdminHelper'} = del_rn($q->param('AdminHelper'));
	$cfg{'AdminHelperID'} = del_rn($q->param('AdminHelperID'));
	$cfg{'AdminHelperNM'} = del_rn($q->param('AdminHelperNM'));
	$cfg{'AdminHelperML'} = del_rn($q->param('AdminHelperML'));
	$cfg{'AuthorName'} = del_rn($q->param('AuthorName'));
	$cfg{'AdminDoor'} = del_rn($q->param('AdminDoor'));
	$cfg{'AdminPassword'} = del_rn($q->param('AdminPassword'));
	$cfg{'IndividualCatLabelDisp'} = del_rn($q->param('IndividualCatLabelDisp'));
	$cfg{'IndividualAuthorDisp'} = del_rn($q->param('IndividualAuthorDisp'));
	my $sendpass = $q->param('password');
	
	####################
	# 書き込み
	my $cfg_file = "./mt4icfg.cgi";
	if (!-e $cfg_file) {
		open(OUT,"> $cfg_file") or die "Can't open		: $!";	# 無ければ上書きモードで新規作成
	} else {
		open(OUT,"+< $cfg_file") or die "Can't open		: $!";	# 有れば読み書きモードで開く
	}
	flock(OUT, 2) or die "Can't flock					: $!";	# ロック確認。ロック
	seek(OUT, 0, 0) or die "Can't seek					: $!";	# ファイルポインタを先頭にセット
	while ( my ( $key , $value ) = each %cfg ) {
		print OUT "$key<>$value\n" or die "Can't print	: $!";	# 書き込む
	}
	truncate(OUT, tell(OUT)) or die "Can't truncate		: $!";	# ファイルサイズを書き込んだサイズにする
	close(OUT);													# closeすれば自動でロック解除

	# 出力
	print "Content-type: text/html; charset=EUC-JP\n\n";

	print '<?xml version="1.0" encoding="EUC-JP"?>';
	print '<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">';
	print '<html xmlns="http://www.w3.org/1999/xhtml" lang="ja" xml:lang="ja">';
	print '<head>';
	print '<meta http-equiv="Content-Type" content="text/html; charset=EUC-JP" />';
	print '<title>MT4i Manager</title>';
	print '<style type="text/css">';
	print 'body { background-color:#ffffcc; }';
	print 'h2 { background-color:#ccffcc;border:solid 2px;text-align:center; }';
	print 'div.input { margin-left:20px;margin-right:20px;margin-bottom:20px; }';
	print 'input { height:22px;margin-bottom:10px; }';
	print '</style>';
	print '</head>';
	print '<body>';
	print '<h2>MT4i Manager '.$version.'</h2>';
	print '設定を保存しました。';
	print "<form action=\"./mt4imgr.cgi\" method=\"post\">";
	print '<input type="submit" name="submit" value="戻る" />';
	print '<input type="hidden" name="password" value="' . $sendpass . '" />';
	print '<input type="hidden" name="mode" value="edit" />';
	print '</form>';
	print "</body>";
	print "</html>";
}

############################################################
# 改行を削除
############################################################
sub del_rn {
	my ($val) = @_;
	$val =~ s/\r//g;
	$val =~ s/\n//g;
	return $val;
}

############################################################
# '<'と'>'を実体参照に変換する
############################################################
sub enc_tag {
	my ($val) = @_;
	$val =~ s/</&lt;/g;
	$val =~ s/>/&gt;/g;
	return $val;
}

############################################################
# Errorの出力
############################################################
sub errorout {
	my ($val) = @_;
	print "Content-type: text/plain; charset=EUC-JP\n\nError!\n$val";
}